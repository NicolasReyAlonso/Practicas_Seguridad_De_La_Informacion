\documentclass[12pt,a4paper]{report}
% Idioma y codificación
\usepackage[spanish]{babel}
\usepackage[utf-8]{inputenc}
\usepackage[T1]{fontenc}
% Márgenes
\usepackage[left=2.5cm,right=2.5cm,top=2.5cm,bottom=2.5cm]{geometry}
% Formato de página
\usepackage{fancyhdr}
\usepackage{lastpage}
% Tipografía
\usepackage{times}
\usepackage{setspace}
\onehalfspacing
% Colores
\usepackage{xcolor}
\definecolor{darkblue}{rgb}{0.1,0.1,0.5}
\definecolor{lightblue}{rgb}{0.9,0.95,1}
% Enlaces e hipervínculos
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=darkblue,
    urlcolor=darkblue,
    citecolor=darkblue
}

% Gráficos y figuras
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}

% Tablas
\usepackage{array}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{multirow}

% Código fuente
\usepackage{listings}
\usepackage{xcolor}

% Configuración de listings
\lstset{
    language=bash,
    basicstyle=\ttfamily\small,
    keywordstyle=\color{darkblue}\bfseries,
    commentstyle=\color{gray},
    stringstyle=\color{red},
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    frame=single,
    frameround=tttt,
    rulecolor=\color{lightblue},
    backgroundcolor=\color{lightblue},
    numbers=left,
    numberstyle=\tiny\color{gray},
    showstringspaces=false,
    aboveskip=10pt,
    belowskip=10pt
}

% Matemáticas
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}

% Enumerar
\usepackage{enumerate}
\usepackage{enumitem}

% Espaciado
\usepackage{parskip}

% Índices
\usepackage{imakeidx}
\makeindex

%% ============================================================================
%% ESTILOS DE PÁGINA
%% ============================================================================

\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textcolor{darkblue}{Práctica 2: Algoritmos de resumen y cifrado}}
\fancyhead[R]{\textcolor{darkblue}{SI}}
\fancyfoot[C]{\thepage\ de \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% Estilo para la primera página
\fancypagestyle{firststyle}{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

%% ============================================================================
%% INFORMACIÓN DEL DOCUMENTO
%% ============================================================================

\title{
    \vspace*{-2cm}
    {\Large \textcolor{darkblue}{\textbf{UNIVERSIDAD DE LAS PALMAS DE GRAN CANARIA}}}\\
    {\Large \textcolor{darkblue}{\textbf{Escuela de Ingeniería Informática}}}\\
    \vspace{1cm}
    {\rule{\textwidth}{2pt}}\\
    \vspace{0.5cm}
    {\LARGE \textbf{Práctica 2:}}\\
    {\LARGE \textbf{Algoritmos de Resumen y Cifrado Simétrico}}\\
    \vspace{0.5cm}
    {\rule{\textwidth}{2pt}}\\
    \vspace{1cm}
    {\large \textbf{Asignatura:} Seguridad de la Información}\\
    {\large \textbf{Curso:} 4º de Grado en Ingeniería Informática}\\
    \vspace{1.5cm}
}

\author{
    \textbf{Autor:} \\
    Nicolás Rey Alonso\\
    \texttt{nicolas.rey101@alu.ulpgc.es}\\
}

\date{
    \vspace{1cm}
    \textbf{Fecha:} Febrero 2026
}

%% ============================================================================
%% DOCUMENTO
%% ============================================================================

\begin{document}

% Portada
\maketitle
\thispagestyle{firststyle}

% Separador
\newpage
\thispagestyle{empty}
\mbox{}
\vfill
\begin{center}
    \textit{``La criptografía es la ciencia y el arte de proteger la información.''}
\end{center}
\vfill
\mbox{}

% Tabla de contenidos
\include{indice}
\include{intro}
\include{resumenes}

%% ============================================================================
%% CAPÍTULO 3: CIFRADO SIMÉTRICO DE DOCUMENTOS
%% ============================================================================

\chapter{Cifrado Simétrico de Documentos}

\section{Descripción teórica}

El cifrado simétrico es una técnica criptográfica en la que se utiliza la misma clave tanto para cifrar como para descifrar. Los elementos principales son:

\begin{itemize}[label=\textbullet]
    \item \textbf{Texto claro:} Documento original sin cifrar
    \item \textbf{Algoritmo de cifrado:} Función matemática que transforma el texto
    \item \textbf{Clave:} Información secreta que controla la transformación
    \item \textbf{Texto cifrado:} Resultado ilegible del proceso
    \item \textbf{Vector de inicialización (IV):} Valor aleatorio para ciertos modos
\end{itemize}

\section{Algoritmos de cifrado simétrico}

\subsection{Cifradores de bloque}

\begin{table}[H]
    \centering
    \caption{Cifradores de bloque empleados}
    \begin{tabularx}{\textwidth}{l|c|c|p{5cm}}
        \toprule
        \textbf{Algoritmo} & \textbf{Tamaño bloque} & \textbf{Tamaño clave} & \textbf{Estado} \\
        \midrule
        AES-256 & 128 bits & 256 bits & Recomendado \\
        3DES/TDES & 64 bits & 168 bits & Deprecado \\
        \bottomrule
    \end{tabularx}
\end{table}

\subsection{Cifradores de flujo}

\begin{table}[H]
    \centering
    \caption{Cifradores de flujo empleados}
    \begin{tabularx}{\textwidth}{l|c|p{5cm}}
        \toprule
        \textbf{Algoritmo} & \textbf{Tamaño clave} & \textbf{Observaciones} \\
        \midrule
        RC4 & Variable & Débil, deprecado \\
        ChaCha20 & 256 bits & Moderno, recomendado \\
        \bottomrule
    \end{tabularx}
\end{table}

\section{Modos de operación}

\begin{table}[H]
    \centering
    \caption{Modos de operación de cifrado en bloque}
    \begin{tabularx}{\textwidth}{l|p{6cm}|p{3cm}}
        \toprule
        \textbf{Modo} & \textbf{Descripción} & \textbf{Seguridad} \\
        \midrule
        ECB & Cada bloque cifra de forma independiente & \textcolor{red}{Inseguro} \\
        CBC & Encadenamiento de bloques con IV & Seguro \\
        OFB & Flujo de retroalimentación de salida & Seguro \\
        CTR & Modo contador & Seguro \\
        GCM & Authenticated encryption & Muy seguro \\
        \bottomrule
    \end{tabularx}
\end{table}

\section{Derivación de claves: PBKDF2}

El estándar PKCS\#5 define los siguientes métodos de derivación:

\begin{itemize}[label=\textbullet]
    \item \textbf{PBKDF1:} Primera versión, limitada
    \item \textbf{PBKDF2:} Versión mejorada, recomendada
\end{itemize}

PBKDF2 genera una clave a partir de una contraseña utilizando:

\begin{equation}
DK = PBKDF2(P, S, c, dkLen)
\end{equation}

Donde:
\begin{itemize}
    \item $P$: Contraseña
    \item $S$: Sal (salt) - mínimo 8 bytes
    \item $c$: Número de iteraciones (por defecto 10000)
    \item $dkLen$: Longitud deseada de la clave
\end{itemize}

\section{Metodología experimental}

\subsection{Archivo de prueba}

Se utiliza un archivo de texto pequeño (31-81 caracteres):

\begin{lstlisting}[caption=Archivo para cifrado simétrico]
Este es un texto de prueba para cifrado simétrico.
\end{lstlisting}

\subsection{Cifrado con contraseña}

\begin{lstlisting}[caption=Cifrado con contraseña y PBKDF2]
openssl enc -aes-256-cbc -pbkdf2 -in archivo.txt \
    -out archivo.bin -pass pass:"contraseña"

# Con información de derivación
openssl enc -aes-256-cbc -pbkdf2 -in archivo.txt \
    -out archivo.bin -pass pass:"contraseña" -p
\end{lstlisting}

\section{Resultados}

\subsection{Cifrado con diferentes algoritmos}

Se realizaron cifrados con los siguientes algoritmos:

\begin{table}[H]
    \centering
    \caption{Resultados del cifrado simétrico}
    \begin{tabularx}{\textwidth}{l|c|c|l}
        \toprule
        \textbf{Algoritmo} & \textbf{Modo} & \textbf{Tamaño} & \textbf{Descifrado} \\
        \midrule
        AES-256 & CBC & [Tamaño] bytes & $\checkmark$ OK \\
        AES-128 & CTR & [Tamaño] bytes & $\checkmark$ OK \\
        3DES & CBC & [Tamaño] bytes & $\checkmark$ OK \\
        3DES & OFB & [Tamaño] bytes & $\checkmark$ OK \\
        RC4 & - & [Tamaño] bytes & $\checkmark$ OK \\
        ChaCha20 & - & [Tamaño] bytes & $\checkmark$ OK \\
        AES-256 & GCM & [Tamaño] bytes & $\checkmark$ OK \\
        \bottomrule
    \end{tabularx}
\end{table}

\subsection{Análisis de overhead}

El tamaño de los archivos cifrados incluye:

\begin{itemize}[label=\textbullet]
    \item \textbf{Sal (Salt):} Primeros 8 bytes (formato: ``Salted\_\_'')
    \item \textbf{Contenido cifrado:} Datos cifrados
    \item \textbf{Padding (si aplica):} Relleno para completar bloques (en modos CBC)
\end{itemize}

Ecuación general:
\begin{equation}
\text{Tamaño\_cifrado} = 16 + \text{ceil}\left(\frac{\text{Tamaño\_original}}{T_{\text{bloque}}}\right) \times T_{\text{bloque}}
\end{equation}

Donde $T_{\text{bloque}}$ es el tamaño del bloque (128 bits para AES, 64 bits para 3DES).

\subsection{Cifrado con clave e IV explícitos}

Se demostró cómo descifrar utilizando la clave y el IV en lugar de la contraseña:

\begin{lstlisting}[caption=Cifrado con información de derivación]
# Obtener clave e IV derivados
openssl enc -aes-256-cbc -pbkdf2 -in archivo.txt \
    -out archivo.bin -pass pass:"contraseña" -p

# Eliminar los 16 bytes de sal
dd if=archivo.bin of=archivo_sin_sal.bin bs=1 skip=16

# Descifrar con clave e IV
openssl enc -aes-256-cbc -d -in archivo_sin_sal.bin \
    -out archivo_descifrado.txt -K <clave_hex> -iv <iv_hex>
\end{lstlisting}

%% ============================================================================
%% CAPÍTULO 4: DEMOSTRACIÓN DE LA PELIGROSIDAD DEL MODO ECB
%% ============================================================================

\chapter{Demostración de la Peligrosidad del Modo ECB}

\section{Fundamento teórico: El problema del modo ECB}

El modo ECB (\textit{Electronic Codebook}) es uno de los modos de operación más simples e inseguros. Su funcionamiento es:

\begin{equation}
C_i = E(K, P_i)
\end{equation}

Donde cada bloque de texto plano $P_i$ se cifra independientemente con la misma clave $K$.

\subsection{Problemas de seguridad}

\begin{enumerate}
    \item \textbf{Determinismo:} Bloques idénticos producen criptogramas idénticos
    \item \textbf{Revelación de patrones:} Patrones en el texto plano se revelan en el cifrado
    \item \textbf{Análisis de frecuencia:} Posible análisis estadístico
    \item \textbf{Imagen de Tux:} El ejemplo clásico demuestra visualmente estas debilidades
\end{enumerate}

\section{Experimento: Cifrado de imágenes}

\subsection{Procedimiento}

Se utilizó una imagen de colores sólidos (PNG de 20-50 KB) para demostrar los problemas de ECB:

\begin{enumerate}
    \item Conversión de la imagen a formato PGM
    \item Separación de cabecera y datos binarios
    \item Cifrado de los datos con AES-256-ECB
    \item Reconstrucción de la imagen cifrada
    \item Conversión de vuelta al formato original
    \item Comparación con modo CBC
\end{enumerate}

\subsection{Comandos utilizados}

\begin{lstlisting}[caption=Cifrado ECB de imágenes]
# Convertir a PGM
convert imagen.png imagen.pgm

# Separar cabecera y datos
head -n 3 imagen.pgm > cabecera.txt
tail -n +4 imagen.pgm > datos.bin

# Cifrado ECB (INSEGURO)
openssl enc -aes-256-ecb -in datos.bin -out datos_ecb.bin \
    -K 0123456789ABCDEF... -nosalt

# Reconstruir y convertir
cat cabecera.txt datos_ecb.bin > imagen_cifrada.pgm
convert imagen_cifrada.pgm imagen_cifrada.png
\end{lstlisting}

\subsection{Comparación de modos}

\begin{table}[H]
    \centering
    \caption{Comparación de modos de operación}
    \begin{tabularx}{\textwidth}{l|p{3cm}|p{3cm}}
        \toprule
        \textbf{Modo} & \textbf{Resultado} & \textbf{Seguridad} \\
        \midrule
        ECB & \textit{Se distinguen patrones de la imagen original} & \textcolor{red}{Crítica} \\
        CBC & \textit{Imagen completamente aleatoria} & \textcolor{green}{Segura} \\
        \bottomrule
    \end{tabularx}
\end{table}

\section{Resultados obtenidos}

\subsection{Imágenes generadas}

Se generaron las siguientes imágenes:

\begin{itemize}[label=\textbullet]
    \item \textbf{Original:} Imagen de colores sólidos clara
    \item \textbf{ECB con AES-256:} Los colores originales son vagamente visibles
    \item \textbf{ECB con 3DES:} Patrones más pronunciados debido a bloques de 64 bits
    \item \textbf{CBC con AES-256:} Imagen completamente aleatoria
\end{itemize}

\section{Conclusiones sobre seguridad}

\begin{itemize}[label=\textbullet]
    \item \textbf{NUNCA usar ECB:} Incluso con claves fuertes, revela patrones
    \item \textbf{Usar CBC, CTR, GCM:} Estos modos son seguros
    \item \textbf{Tamaño de bloque:} Bloques mayores (128 bits) ocultan mejor los patrones
    \item \textbf{IV aleatorio:} Esencial en modos que requieren IV
\end{itemize}

%% ============================================================================
%% CAPÍTULO 5: CONCLUSIONES
%% ============================================================================

\chapter{Conclusiones}

\section{Resumen de aprendizajes}

A través de esta práctica se han consolidado los siguientes conceptos:

\begin{enumerate}
    \item \textbf{Algoritmos de resumen:} Importancia de la sensibilidad y tamaño del hash
    \item \textbf{Cifrado simétrico:} Uso correcto de algoritmos y modos de operación
    \item \textbf{Derivación de claves:} PBKDF2 como estándar seguro
    \item \textbf{Modos seguros vs. inseguros:} Errores comunes en criptografía
\end{enumerate}

\section{Recomendaciones de seguridad}

Para aplicaciones reales:

\begin{enumerate}
    \item \textbf{Resúmenes:} Usar SHA-256 o superior (SHA-3)
    \item \textbf{Cifrado simétrico:} Preferir AES con modo CBC, CTR o GCM
    \item \textbf{Derivación de claves:} PBKDF2 con mínimo 100,000 iteraciones
    \item \textbf{Sal:} Mínimo 16 bytes de sal aleatoria
    \item \textbf{IV:} Aleatorio y único para cada cifrado en modos que lo requieran
\end{enumerate}

\section{Problemas encontrados y soluciones}

\begin{itemize}[label=\textbullet]
    \item \textbf{Provider Legacy:} Fue necesario activarlo para usar algoritmos antiguos (MD5, RC4)
    \item \textbf{Formatos binarios:} Importancia de usar \texttt{-binary} en OpenSSL
    \item \textbf{Imágenes comprimidas:} No funcionan bien con el experimento ECB
\end{itemize}

\section{Trabajos futuros}

\begin{enumerate}
    \item Estudiar cifrado asimétrico (RSA, ECDSA)
    \item Implementar funciones hash criptográficas personalizadas
    \item Analizar vulnerabilidades de padding (Padding Oracle)
    \item Estudiar Side-channel attacks en criptografía
\end{enumerate}

%% ============================================================================
%% BIBLIOGRAFÍA
%% ============================================================================

\begin{thebibliography}{99}

\bibitem{openssl_docs} OpenSSL Documentation, \textit{https://www.openssl.org/docs/man3.2/}, 2024.

\bibitem{pkcs5} RSA Laboratories, \textit{PKCS \#5: Password-Based Cryptography Specification}, RFC 2898, 2000.

\bibitem{aes} NIST Federal Information Processing Standards Publication 197, \textit{Specification for the Advanced Encryption Standard (AES)}, 2001.

\bibitem{pbkdf2} Kelm, R., Turan, M. S., \textit{PBKDF2 Implementation in OpenSSL}, 2023.

\bibitem{ecb_danger} Wikipedia, \textit{Block cipher mode of operation}, https://en.wikipedia.org/wiki/Block\_cipher\_mode\_of\_operation, 2024.

\bibitem{tux} Wikipedia, \textit{Electronic Codebook (ECB) - Tux the Linux Penguin}, https://en.wikipedia.org/wiki/Block\_cipher\_mode\_of\_operation\#ECB, 2024.

\bibitem{md5} Rivest, R., \textit{The MD5 Message-Digest Algorithm}, RFC 1321, 1992.

\bibitem{sha} FIPs 180-4: Secure Hash Standard, National Institute of Standards and Technology, 2015.

\end{thebibliography}

%% ============================================================================
%% APÉNDICES
%% ============================================================================

\appendix

\chapter{Comandos OpenSSL Utilizados}

\section{Comandos de hash}

\begin{lstlisting}[caption=Comandos para resúmenes]
# Listar algoritmos disponibles
openssl dgst -list

# Diferentes formatos
openssl dgst -md5 archivo.txt
openssl dgst -sha256 -c archivo.txt          # Con separadores
openssl dgst -sha256 -binary archivo.txt     # Binario
\end{lstlisting}

\section{Comandos de cifrado}

\begin{lstlisting}[caption=Comandos para cifrado simétrico]
# Listar cifradores disponibles
openssl enc -list

# Cifrado básico
openssl enc -aes-256-cbc -in archivo.txt -out archivo.bin \
    -pass pass:"contraseña"

# Con información de derivación
openssl enc -aes-256-cbc -in archivo.txt -out archivo.bin \
    -pass pass:"contraseña" -pbkdf2 -p

# Descifrado
openssl enc -aes-256-cbc -d -in archivo.bin -out archivo.txt \
    -pass pass:"contraseña" -pbkdf2
\end{lstlisting}

\section{Comandos para manipulación de archivos}

\begin{lstlisting}[caption=Comandos útiles]
# Ver información del archivo
file archivo.bin
hexdump -C archivo.bin | head -n 5

# Eliminar primeros N bytes
dd if=entrada.bin of=salida.bin bs=1 skip=16

# Conocer tamaño
wc -c archivo.bin
\end{lstlisting}

\chapter{Configuración de ImageMagick}

\section{Instalación}

En macOS:
\begin{lstlisting}
brew install imagemagick
brew install ghostscript
\end{lstlisting}

En Linux:
\begin{lstlisting}
apt install imagemagick
apt install ghostscript
\end{lstlisting}

\section{Conversiones útiles}

\begin{lstlisting}[caption=Conversiones de imagen]
# PNG a PGM
convert imagen.png imagen.pgm

# PGM a PNG
convert imagen.pgm imagen.png

# Crear imagen de prueba
convert -size 200x200 xc:red -fill blue \
    -draw 'rectangle 0,0 100,200' test.png
\end{lstlisting}

\end{document}
